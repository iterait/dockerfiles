FROM pritunl/archlinux
MAINTAINER Cognexa Solutions s.r.o. <docker@cognexa.com>

# install common packages, setup up user `aur` and install `pacaur` and `yaourt`
RUN pacman --noconfirm -S git \
                          expac \
                          yajl \
                          base-devel \
                          opencv \
                          python \
                          vim \
                          python-numpy \
                          python-pandas \
                          python-scipy \
                          python-pip && \
    useradd -m -s /bin/bash aur && \
    passwd -d aur && \
    echo 'aur ALL=(ALL) ALL' > /etc/sudoers.d/aur && \
    echo 'Defaults env_keep += "EDITOR"' >> /etc/sudoers.d/aur && \
    mkdir /build && \
    chown -R aur:aur /build && \
    cd /build && \
    export PATH="/usr/bin/core_perl:$PATH" && \
    sudo -u aur curl -o PKGBUILD 'https://aur.archlinux.org/cgit/aur.git/plain/PKGBUILD?h=cower' && \
    sudo -u aur makepkg PKGBUILD --skippgpcheck --install --needed --noconfirm && \
    sudo -u aur curl -o PKGBUILD 'https://aur.archlinux.org/cgit/aur.git/plain/PKGBUILD?h=pacaur' && \
    sudo -u aur makepkg PKGBUILD --skippgpcheck --install --needed --noconfirm && \
    cd / && \
    rm -rf /build

# install GPU related stuff
RUN pacman --noconfirm -S nvidia \
                          nvidia-utils \
                          cuda
RUN sudo -u aur pacaur --noconfirm -S cudnn6
