FROM pritunl/archlinux
MAINTAINER Cognexa Solutions s.r.o. <docker@cognexa.com>

# install common packages, setup up user `aur` and install `pacaur`
RUN pacman --noconfirm --needed -S \
      git \
      expac \
      yajl \
      base-devel \
      opencv \
      python \
      vim \
      python-numpy \
      python-pandas \
      python-scipy \
      python-pip \
    && paccache -rfk0

RUN useradd -m -s /bin/bash aur \
    && passwd -d aur \
    && echo 'aur ALL=(ALL) ALL' > /etc/sudoers.d/aur \
    && echo 'Defaults env_keep += "EDITOR"' >> /etc/sudoers.d/aur \
    && mkdir /build \
    && chown -R aur:aur /build \
    && cd /build \
    && export PATH="/usr/bin/core_perl:$PATH" \
    && sudo -u aur curl -o PKGBUILD 'https://aur.archlinux.org/cgit/aur.git/plain/PKGBUILD?h=cower' \
    && sudo -u aur makepkg PKGBUILD --skippgpcheck --install --needed --noconfirm \
    && sudo -u aur curl -o PKGBUILD 'https://aur.archlinux.org/cgit/aur.git/plain/PKGBUILD?h=pacaur' \
    && sudo -u aur makepkg PKGBUILD --skippgpcheck --install --needed --noconfirm \
    && cd / \
    && rm -rf /build \
    && paccache -rfk0

ENV EDITOR vim

# install GPU related stuff
RUN pacman --noconfirm --needed -S \
      nvidia \
      nvidia-utils \
      cuda \
      cudnn \
    && paccache -rfk0
